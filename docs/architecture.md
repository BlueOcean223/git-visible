# 架构设计

## 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                      main.go                            │
│                   cmd.Execute()                         │
└─────────────────────────┬───────────────────────────────┘
                          │
┌─────────────────────────▼───────────────────────────────┐
│                      cmd/                               │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │
│  │ root.go  │ │ show.go  │ │ add.go   │ │ list.go  │   │
│  │ (默认)   │ │ (热力图) │ │ (扫描)   │ │ (列表)   │   │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐               │
│  │remove.go │ │ set.go   │ │version.go│               │
│  │ (移除)   │ │ (配置)   │ │ (版本)   │               │
│  └──────────┘ └──────────┘ └──────────┘               │
└─────────────────────────┬───────────────────────────────┘
                          │
┌─────────────────────────▼───────────────────────────────┐
│                    internal/                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │   config/   │  │    repo/    │  │   stats/    │     │
│  │ config.go   │  │ storage.go  │  │collector.go │     │
│  │ (配置读写)  │  │ scanner.go  │  │renderer.go  │     │
│  │             │  │ (仓库管理)  │  │ (统计渲染)  │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────┘
```

## 数据流

### show 命令（热力图展示）
```
show 命令
    │
    ▼
repo.LoadRepos() ──► 读取 ~/.config/git-visible/repos
    │
    ▼
stats.CollectStats() ──► 并发遍历仓库，go-git 读取提交
    │                     按邮箱/时间过滤
    │                     返回 map[time.Time]int
    ▼
stats.RenderHeatmap() ──► 渲染热力图到终端
```

### add 命令（添加仓库）
```
add 命令
    │
    ▼
repo.ScanRepos() ──► 递归扫描目录，查找 .git
    │                 支持深度限制、排除目录
    ▼
repo.AddRepo() ──► 写入 ~/.config/git-visible/repos
```

## 文件存储

| 文件 | 路径 | 格式 |
|------|------|------|
| 配置 | `~/.config/git-visible/config.yaml` | YAML |
| 仓库列表 | `~/.config/git-visible/repos` | 纯文本，每行一个路径 |

### config.yaml 示例
```yaml
email: "your@email.com"
months: 6
```

### repos 示例
```
/Users/xxx/code/project1
/Users/xxx/code/project2
```
